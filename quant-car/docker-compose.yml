# ============================================
# QuantDash - Production Docker Compose
# ============================================

services:
  # FastAPI Backend
  api:
    build:
      context: ./apps/api
      dockerfile: Dockerfile
    container_name: quantdash-api
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - DATA_OUTPUT_DIR=/data/outputs
      - DEBUG=false
    volumes:
      # Mount RiskFusion data (read-only)
      - ${RISKFUSION_DATA:-./data}:/data:ro
    healthcheck:
      test: [ "CMD", "curl", "-f", "http://localhost:8000/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - quantdash

  # Next.js Frontend
  cockpit:
    build:
      context: ./apps/cockpit
      dockerfile: Dockerfile
    container_name: quantdash-cockpit
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_API_BASE_URL=http://api:8000
      - NEXT_PUBLIC_WS_URL=ws://api:8000
    depends_on:
      api:
        condition: service_healthy
    networks:
      - quantdash

networks:
  quantdash:
    driver: bridge

# ============================================
# Usage:
#   docker-compose up --build
#   docker-compose up -d           # detached
#   docker-compose logs -f         # view logs
#   docker-compose down            # stop all
# ============================================
